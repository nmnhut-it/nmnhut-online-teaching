<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade 9 - Vocabulary: Community, City Life & Wellness | English Grammar Games</title>
  <meta name="description" content="Practice vocabulary about community helpers, city life, and mental wellness">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Grade 9 - Vocabulary Quiz</h1>
          <p class="game-header__subtitle">Community, City Life & Wellness</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">GiÃ¡o viÃªn:</span>
              <span class="game-info__value">Nguyá»…n Minh Nhá»±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">Há»c sinh:</span>
              <span class="game-info__value">Lá»›p 9</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">Äiá»ƒm</span>
            <span class="stat__value stat__value--primary" id="current-score">â­ 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Tiáº¿n Ä‘á»™</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>ğŸ“– Vocabulary Reference</span>
        <span class="theory-panel__icon" id="theory-icon">â–¼</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">Section 1: Community & Occupations</h3>
          <ul style="column-count: 2; column-gap: 20px;">
            <li><strong>artisan</strong> /ËŒÉ‘ËtÉªËˆzÃ¦n/ - thá»£ lÃ m nghá» thá»§ cÃ´ng</li>
            <li><strong>community</strong> /kÉ™ËˆmjuËnÉ™ti/ - cá»™ng Ä‘á»“ng</li>
            <li><strong>community helper</strong> - ngÆ°á»i phá»¥c vá»¥ cá»™ng Ä‘á»“ng</li>
            <li><strong>craft village</strong> - lÃ ng nghá» thá»§ cÃ´ng</li>
            <li><strong>delivery person</strong> - nhÃ¢n viÃªn giao hÃ ng</li>
            <li><strong>electrician</strong> /ÉªËŒlekËˆtrÉªÊƒn/ - thá»£ Ä‘iá»‡n</li>
            <li><strong>firefighter</strong> /ËˆfaÉªÉ™faÉªtÉ™/ - lÃ­nh cá»©u hoáº£</li>
            <li><strong>garbage collector</strong> - nhÃ¢n viÃªn dá»n vá»‡ sinh</li>
            <li><strong>police officer</strong> - cÃ´ng an</li>
            <li><strong>handicraft</strong> - sáº£n pháº©m thá»§ cÃ´ng</li>
            <li><strong>facilities</strong> - cÆ¡ sá»Ÿ váº­t cháº¥t</li>
            <li><strong>preserve</strong> /prÉªËˆzÉœËv/ - báº£o tá»“n</li>
            <li><strong>speciality</strong> - Ä‘áº·c sáº£n</li>
            <li><strong>tourist attraction</strong> - Ä‘iá»ƒm du lá»‹ch</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">Section 2: City Life</h3>
          <ul style="column-count: 2; column-gap: 20px;">
            <li><strong>bustling</strong> /ËˆbÊŒslÉªÅ‹/ - há»‘i háº£, nhá»™n nhá»‹p</li>
            <li><strong>concrete jungle</strong> - rá»«ng bÃª tÃ´ng</li>
            <li><strong>congested</strong> /kÉ™nËˆdÊ’estÉªd/ - táº¯c ngháº½n</li>
            <li><strong>downtown</strong> - khu trung tÃ¢m thÃ nh phá»‘</li>
            <li><strong>metro</strong> /ËˆmetrÉ™ÊŠ/ - há»‡ thá»‘ng tÃ u Ä‘iá»‡n ngáº§m</li>
            <li><strong>rush hour</strong> - giá» cao Ä‘iá»ƒm</li>
            <li><strong>sky train</strong> - tÃ u Ä‘iá»‡n trÃªn khÃ´ng</li>
            <li><strong>tram</strong> /trÃ¦m/ - xe Ä‘iá»‡n</li>
            <li><strong>underground</strong> - tÃ u Ä‘iá»‡n ngáº§m</li>
            <li><strong>liveable</strong> /ËˆlÉªvÉ™bl/ - Ä‘Ã¡ng sá»‘ng</li>
            <li><strong>suburb</strong> /ËˆsÊŒbÉœËb/ - vÃ¹ng ngoáº¡i Ã´</li>
            <li><strong>public amenities</strong> - tiá»‡n Ã­ch cÃ´ng cá»™ng</li>
            <li><strong>construction site</strong> - cÃ´ng trÆ°á»ng xÃ¢y dá»±ng</li>
            <li><strong>pricey</strong> - Ä‘áº¯t Ä‘á»</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">Section 3: Stress & Achievement</h3>
          <ul style="column-count: 2; column-gap: 20px;">
            <li><strong>accomplish</strong> /É™ËˆkÊŒmplÉªÊƒ/ - hoÃ n thÃ nh, Ä‘áº¡t Ä‘Æ°á»£c</li>
            <li><strong>anxiety</strong> /Ã¦Å‹ËˆzaÉªÉ™ti/ - ná»—i lo, sá»± lo láº¯ng</li>
            <li><strong>deadline</strong> /ËˆdedlaÉªn/ - thá»i háº¡n cuá»‘i cÃ¹ng</li>
            <li><strong>distraction</strong> /dÉªËˆstrÃ¦kÊƒn/ - Ä‘iá»u lÃ m sao lÃ£ng</li>
            <li><strong>mental</strong> /Ëˆmentl/ - (thuá»™c) tinh tháº§n</li>
            <li><strong>minimise</strong> /ËˆmÉªnÉªmaÉªz/ - giáº£m Ä‘áº¿n má»©c tá»‘i thiá»ƒu</li>
            <li><strong>mood</strong> /muËd/ - tÃ¢m tráº¡ng</li>
            <li><strong>optimistic</strong> /ËŒÉ’ptÉªËˆmÉªstÉªk/ - láº¡c quan</li>
            <li><strong>priority</strong> /praÉªËˆÉ’rÉ™ti/ - sá»± Æ°u tiÃªn</li>
            <li><strong>stressed out</strong> - cÄƒng tháº³ng</li>
            <li><strong>assignment</strong> - nhiá»‡m vá»¥, bÃ i táº­p</li>
            <li><strong>counsellor</strong> - cá»‘ váº¥n, ngÆ°á»i tÆ° váº¥n</li>
            <li><strong>due date</strong> - háº¡n chÃ³t</li>
            <li><strong>well-balanced</strong> - cÃ¢n báº±ng, Ä‘Ãºng má»±c</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">Important Phrasal Verbs</h3>
          <ul style="column-count: 2; column-gap: 20px;">
            <li><strong>cut down on</strong> - cáº¯t giáº£m</li>
            <li><strong>hand down / pass down</strong> - truyá»n láº¡i</li>
            <li><strong>run out of</strong> - háº¿t, cáº¡n kiá»‡t</li>
            <li><strong>get on with</strong> - cÃ³ quan há»‡ tá»‘t vá»›i</li>
            <li><strong>look around</strong> - ngáº¯m nghÃ­a xung quanh</li>
            <li><strong>carry out</strong> - tiáº¿n hÃ nh</li>
            <li><strong>come down with</strong> - bá»‹ á»‘m</li>
            <li><strong>get around</strong> - Ä‘i xung quanh, di chuyá»ƒn</li>
            <li><strong>hang out with</strong> - Ä‘i chÆ¡i (cÃ¹ng ai)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container" class="mt-3">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>
  <script src="../js/exercises/vocabulary-match.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'g9-vocab-city-life';
    const DATA_PATH = '../data/g9-vocab-city-life.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x ğŸ”¥';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      // Initialize student name
      StudentNameManager.init();
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
